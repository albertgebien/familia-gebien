<?xml version="1.0" encoding="ISO-8859-1"?> 

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:asp="http://achesuapeca.com.br/taglib"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	template="/template/mainTemplate.xhtml">

	<ui:define name="corpo">
	
		<f:metadata>
        	<f:viewAction action="#{pessoaController.inicializar(param.idPessoa)}"/>
    	</f:metadata>
		<h:form id="form" prependId="false" >
			 <p:wizard flowListener="#{pessoaController.processar}" backLabel="Voltar" nextLabel="Próximo" showNavBar="true" showStepStatus="true" id="cads">
		        <p:tab id="cadPessoa" title="Cadastro">
	                <p:panel header="Cadastro de Pessoa">
		                <p:messages />
						<h:panelGrid id="grid" columns="2" cellpadding="5">
							<h:outputLabel value="Nome completo*:" />
							<p:inputText value="#{pessoaController.pessoa.nome}" required="true" requiredMessage="O campo nome é obrigatório"/>
		
							<h:outputLabel value="Sexo*:" />
							<p:selectOneRadio id="sexo" value="#{pessoaController.pessoa.sexo}" required="true" requiredMessage="O campo sexo é obrigatório">
					            <f:selectItem itemLabel="F" itemValue="F" />
					            <f:selectItem itemLabel="M" itemValue="M" />
					        </p:selectOneRadio>
							
							<h:outputLabel value="E-mail:" />
							<p:inputText value="#{pessoaController.pessoa.email}" />
													
							<h:outputLabel value="Data de nascimento:" />
							<p:calendar value="#{pessoaController.pessoa.dataNascimento}" pattern="dd/MM/yyyy" mask="true"/>
		
							<h:outputLabel value="Cidade de nascimento*:" />
							<p:inputText value="#{pessoaController.pessoa.cidade}"/>
		
							<h:outputLabel value="Estado de nascimento:*" />
							<p:selectOneMenu id="estado" value="#{pessoaController.pessoa.estado}" required="true" requiredMessage="O campo estado é obrigatório">
					            <f:selectItem itemLabel="Selecione" itemValue="" />
					            <f:selectItem itemLabel="DF" itemValue="DF" />
					        </p:selectOneMenu>
		
							<h:outputLabel value="País de nascimento*:" />
							<p:inputText value="#{pessoaController.pessoa.pais}" required="true" requiredMessage="O campo país é obrigatório"/>
		
							<h:outputLabel value="Falecida?" />
							<p:selectBooleanButton value="#{pessoaController.bolFalecida}" onLabel="Sim" offLabel="Não" onIcon="ui-icon-check" offIcon="ui-icon-close" >
		            			<p:ajax listener="#{pessoaController.onChangePessoaFalecida}" update="lblDataFalecimento,dataFalecimento"/>
		        			</p:selectBooleanButton>
							
							<h:outputLabel id="lblDataFalecimento" value="Data de falecimento:" />
							<p:calendar id="dataFalecimento" value="#{pessoaController.pessoa.dataFalecimento}" disabled="#{!pessoaController.bolFalecida}" mask="99/99/9999"/>
		
						</h:panelGrid>
	            	</p:panel>
	       	 	</p:tab>
	       	 	
	       	 	 <p:tab id="cadRel" title="Relacionamentos">
	                <p:panel header="Cadastro de Relacionamentos">
		                <p:messages />
						<h:panelGrid columns="2" cellpadding="5">
							<h:outputLabel value="Pessoa*:" />
							
							<p:outputPanel>
								<h:outputLabel id="pessoaSelecionada" value="#{pessoaController.pessoaSelecionada.nome}" />
								<p:spacer width="20"/>
								<p:commandButton type="button" onclick="PF('pesquisarPessoa').show();" icon="ui-icon-search"/>
							</p:outputPanel>
							  
							<h:outputLabel value="Tipo relacionamento*:" />
							<p:selectOneMenu value="#{pessoaController.idTipoRelacionamentoSelecionado}" required="true" requiredMessage="O campo tipo relacionamento é obrigatório">
					            <f:selectItems value="#{pessoaController.listaTipoRelacionamento}"/>
		        			</p:selectOneMenu>
		        			<h:outputLabel value="Data casamento*:" />
		        			<p:calendar value="#{pessoaController.dataCasamento}" mask="true" pattern="dd/MM/yyyy"/>
		        			
		        			<p:commandButton id="salvarRelacionamento" value="Salvar" action="#{pessoaController.inserirRelacionamento}" />
							<p:spacer width="10"/>
		        			<p:commandButton id="incluirPessoa" value="Incluir pessoa" onclick="PF('incluirPessoaDLG').hide();" />
		        			
						</h:panelGrid>
		        			<br/>
		        			<br/>
		        			<p:dataTable id="relacionamentos" 
	                            rows="15"
	                            var="p"
	                            paginator="true"
	                            value="#{pessoaController.relacionamentos}"
	                            paginatorPosition="bottom"
	                            paginatorAlwaysVisible="false"
	                            emptyMessage="Vazio">
	
		                    <p:column headerText="Nome">
		                        #{p.pessoa.nome}
		                    </p:column>
		                    
		                    <p:column headerText="Pessoa Relacionada">
		                        #{p.pessoaRelacionada.nome}
		                    </p:column>

		                    <p:column headerText="Tipo relacionamento">
		                        #{p.tipoRelacionamentoPessoa.nomeTipoRelacionamento}
		                    </p:column>

		                    <p:column headerText="Ações">
    	                        <p:commandButton icon="ui-icon-trash"
                                             actionListener="#{pessoaController.excluirRelacionamento(p.id.idPessoa ,p.id.idPessoaRelacionada)}" 
                                             update="relacionamentos"/>
		                    </p:column>
	                  
	  		            </p:dataTable>
	            	</p:panel>
	       	 	</p:tab>
        	</p:wizard>
		</h:form>
		
		<p:dialog header="Pessoas" widgetVar="pesquisarPessoa" width="500" height="500">
    		<h:form prependId="false">
    					<h:panelGrid columns="3" cellpadding="5">
							<h:outputLabel value="Nome:" />
							<p:inputText value="#{pessoaController.nomePesquisa}"/>
							<p:commandButton value="Pesquisar" actionListener="#{pessoaController.pesquisarPessoa}" update="listaPessoa"/>
						</h:panelGrid>

						<p:dataTable id="listaPessoa" 
	                            rows="15"
	                            var="p"
	                            paginator="true"
	                            value="#{pessoaController.listaPessoasPesquisa}"
	                            paginatorPosition="bottom"
	                            paginatorAlwaysVisible="false"
	                            emptyMessage="Vazio"
	                            selectionMode="single" selection="#{pessoaController.pessoaSelecionada}" rowKey="#{p.id}">
	
		                    <p:column headerText="Nome">
		                        #{p.nome}
		                    </p:column>
		                   
		                    <p:column headerText="Data nascimento">
		                        #{p.dataNascimento}
		                    </p:column>
	                  
	  		            </p:dataTable>
	  		            
	  		            <p:commandButton value="Selecionar" onclick="PF('pesquisarPessoa').hide();" update=":form:pessoaSelecionada"/>
	  		           </h:form>
					</p:dialog>  
					
		<p:dialog header="Pessoas" widgetVar="incluirPessoaDLG">
    		<h:form prependId="false" id="formPessoaDLG">
    			<p:messages />
				<h:panelGrid id="formPessoaDLGrid" columns="2" cellpadding="5">
					<h:outputLabel value="Nome completo*:" />
					<p:inputText value="#{pessoaDialogController.pessoa.nome}" required="true" requiredMessage="O campo nome é obrigatório"/>

					<h:outputLabel value="Sexo*:" />
					<p:selectOneRadio value="#{pessoaDialogController.pessoa.sexo}" required="true" requiredMessage="O campo sexo é obrigatório">
			            <f:selectItem itemLabel="F" itemValue="F" />
			            <f:selectItem itemLabel="M" itemValue="M" />
			        </p:selectOneRadio>
					
					<h:outputLabel value="E-mail:" />
					<p:inputText value="#{pessoaDialogController.pessoa.email}" />
											
					<h:outputLabel value="Data de nascimento:" />
					<p:calendar value="#{pessoaDialogController.pessoa.dataNascimento}" pattern="dd/MM/yyyy" mask="true"/>

					<h:outputLabel value="Cidade de nascimento*:" />
					<p:inputText value="#{pessoaDialogController.pessoa.cidade}"/>

					<h:outputLabel value="Estado de nascimento:*" />
					<p:selectOneMenu value="#{pessoaDialogController.pessoa.estado}" required="true" requiredMessage="O campo estado é obrigatório">
			            <f:selectItem itemLabel="Selecione" itemValue="" />
			            <f:selectItem itemLabel="DF" itemValue="DF" />
			        </p:selectOneMenu>

					<h:outputLabel value="País de nascimento*:" />
					<p:inputText value="#{pessoaDialogController.pessoa.pais}" required="true" requiredMessage="O campo país é obrigatório"/>

					<h:outputLabel value="Falecida?" />
					<p:selectBooleanButton value="#{pessoaDialogController.bolFalecida}" onLabel="Sim" offLabel="Não" onIcon="ui-icon-check" offIcon="ui-icon-close" >
            			<p:ajax listener="#{pessoaDialogController.onChangePessoaFalecida}" update="lblDataFalecimento2,dataFalecimento2"/>
        			</p:selectBooleanButton>
					
					<h:outputLabel id="lblDataFalecimento2" value="Data de falecimento:" />
					<p:calendar id="dataFalecimento2" value="#{pessoaDialogController.pessoa.dataFalecimento}" disabled="#{!pessoaDialogController.bolFalecida}" mask="99/99/9999"/>
					
					<p:commandButton id="incluirPessoaButton" value="Inserir" action="#{pessoaDialogController.incluir}" oncomplete="PF('incluirPessoa').hide();"   />
				</h:panelGrid>
			</h:form>
		</p:dialog>   
	</ui:define>
</ui:composition>